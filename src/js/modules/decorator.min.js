/* TextareaDecorator.js
 * written by Colin Kuebler 2012
 * Part of LDT, dual licensed under GPLv3 and MIT
 * Builds and maintains a styled output layer under a textarea input layer
 */
function Decorator(i,l){var t=this,e=document.createElement("div"),c=document.createElement("pre");e.appendChild(c);var n=document.createElement("label");e.appendChild(n),i.parentNode.replaceChild(e,i),n.appendChild(i),e.className="ldt "+i.className,i.className="",i.spellcheck=!1;return t.input=i,t.output=c,t.update=function(){var s=i.value;if(s){!function(e,t){for(var n,r,a=e.childNodes,o=t.tokenize(s),i=0;i<o.length&&i<a.length&&o[i]===a[i].textContent;i++);for(;o.length<a.length;)e.removeChild(a[i]);for(n=o.length-1,r=a.length-1;i<r&&o[n]===a[r].textContent;n--,r--);for(;i<=r;i++)a[i].className=t.identify(o[i]),a[i].textContent=a[i].innerText=o[i];for(var l=a[i]||null;i<=n;i++){var c=document.createElement("span");c.className=t.identify(o[i]),c.textContent=c.innerText=o[i],e.insertBefore(c,l)}}(c,l);for(var e=s.split("\n"),t=0,n=0;n<e.length;n++){for(var r=0,a=-1;-1<(a=e[n].indexOf("\t",a+1));)r+=7-(r+a)%8;var o,t=(o=e[n].length+r)<t?t:o}}else c.innerHTML=""},i.addEventListener?i.addEventListener("input",t.update,!1):i.attachEvent("onpropertychange",function(e){"value"===e.propertyName.toLowerCase()&&t.update()}),t.update(),t}var SelectHelper={add:function(a){a.insertAtCursor=a.createTextRange?function(e){document.selection.createRange().text=e}:function(e){var t=a.selectionStart,n=a.selectionEnd,r=a.value;a.value=r.substring(0,t)+e+r.substring(n),t+=e.length,a.setSelectionRange(t,t)}}};function Parser(e,r){var t=this,r=r?"i":"",a=null,o=[],i={};return t.add=function(e){for(var t in e){var n=e[t].source;o.push(n),i[t]=new RegExp("^("+n+")$",r)}a=new RegExp(o.join("|"),"g"+r)},t.tokenize=function(e){return e.match(a)},t.identify=function(e){for(var t in i)if(i[t].test(e))return t},t.add(e),t}var Keybinder={bind:function(r,e){r.keymap=e;function t(e){var t="";(e=e||window.event).shiftKey&&(t+="Shift-"),e.ctrlKey&&(t+="Ctrl-"),e.altKey&&(t+="Alt-"),e.metaKey&&(t+="Meta-");var n=e.which||e.keyCode||e.charCode;return t+=a[n]||String.fromCharCode(n).toUpperCase(),!r.keymap[t]||!r.keymap[t]()||(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1)}var a={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLk",27:"Esc",33:"PgUp",34:"PgDn",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",145:"ScrLk"},n=!0;r.onkeydown=function(e){return n=!1,t(e)},r.onkeypress=function(e){return n?t(e):n=!0}}};